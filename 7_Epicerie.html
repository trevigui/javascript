<!--  A RETENIR : Red√©finir une variable par un autre type a TOUT LE TEMPS des effets inattendus, undefined machin chose. Ne pas red√©finir une variable integer en string et vi√ße-versa. -->
<!-- On peut rajouter un label √† une boucle (choiceLoop:) pour pouvoir revenir au d√©but de la boucle depuis n'importe o√π avec 'break choiceLoop;' ou 'continue choiceLoop;'. Pas r√©ussi √† labelliser des if statements en revanche. -->
<!-- Attention, l'ojet prototypique "length" commence √† 1 tandis que les index commendent √† 0. Prendre √ßa en compte en faisant un -1 lors du code. -->
<!-- CE CODE A BEAUCOUP TROP DE CONTINUE, IL EST DEGEULASSE. -->

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/7_epicerie.css">
    <title>Document</title>
</head>


<script>

    function theGame() {

        let fruits = [ 'Figue','Fraise', 'Rhubarbe', 'Pizza', 'Sauce tomate', 'Yaourt p√©rim√©', 'Fromage en spray', 'Isolation phonique' ];
        let choice = 'startValue';                                          // Pr√©d√©finition de la variable 'choice'  appeler le premier prompt demandant le fruit √† acheter.
        let confirmation = 'startValue';                                                                                                                         /////// Je ne peux pas d√©clarer ma variable dans mes statements else je le fais en avance ici.
        var infiniteChoice = 0;
                                                                                                                                                                 /////// infiniteChoice is my terrible way of going back and forth between the 'if' and 'if else' statements, by using it as another condition.
        choiceLoop:
        for (osef = 0, end = false ; end === false ; osef++) {              // Boucle pour demander plusieurs fois si le client veut un autre fruit.                                                                                                                             // Label √† rappeler avec break; (ou continue; pour les loops.)
            if ( fruits.length !== 0 && choice === 'startValue' || fruits.length !== 0 && choice === 'retry' || fruits.length !== 0 && infiniteChoice === 0) {     //Si c'est le d√©but || si c'est un mauvais fruit || si le statement infiniteChoice n'a pas √©t√© trigger par la vvariable infiniteChoice =&.                                                                        // Confirmation qu'on doit r√©p√©ter les && entre chaque || (machin1 && machin2 || machin1 && machin3)
                choice = prompt(`Voici la liste de fruits disponibles en vente :\n${fruits.join('   ü§©   ')}\n\nQuel fruit d√©sirez-vous acheter ?`) ;           /////// beware, loops might outright not load if you declare the same variables two times usign 'let' both times. No error on console too...
                
                if (fruits.join(' * ').toLowerCase().includes( choice.toLowerCase() ) === true) {                                                                /////// pas besoin de pr√©ciser includes(choice) === true, le true est sous-entendu. // La m√©thode .join() est identique √† .toString mais permet de s√©parer les valeurs ave cle carat√®re de mon choice. Convertir mon array en string est obligatoire pour pouvoir utiiser .toLowerCase(). Sinon erreur 'fruits.toLowerCase() is not a function'.
                    for (a = 0, stop = 0 ; stop !== 1 ; a++ ) {                                                                                                  /////// Index 0 might never be checked if a++ applies immediately rather than after the first loop. Needs further testing...
                        if (fruits[Number(a)].toLowerCase().includes( choice.toLowerCase() ) === true) {                                                         /////// A variable isn't recognized as an integer by default, its content is read as a literal string, so I had to use parseInt() or Number()... // Notice how .length is not a method, but a property (no () parentheses)
                            fruits.splice(a, 1);
        
                            if (fruits.length > 0) {
                                alert('Merci, votre achat a bien √©t√© pris en compte.') ;
                                stop = 1 ;
                                infiniteChoice = 1;                                        
                                break;
                            }
                            else if (fruits.length === 0) {
                                let success = new Audio('/resources/sound.mp3');
                                success.play();
                                alert(`Succ√®s d√©verrouill√© : "Cambriolage de haut vol."\n\nBien jou√© !`)
                                end = true
                                break;
                            }
                        } else if (fruits[Number(a)].toLowerCase().includes( choice.toLowerCase() ) === false) {                                                 /////// OK very weird. An error occurs here when picking Kiwi, it's normal, when the fruit array is spliced, one index always disappears. Therefore by selecting kiwi(index 4) in 'if' parameter, there is no more index 4 for 'if else' to act upon. Problem is this error interrups the loop for some reason. It shouldn't, as else should only be called after unseuccessful ifs. Changing the for loop end condition not to look at the 'a' variable fixed it. It was a weir issur caused by literal/integer mistranslation by javascript.
                            continue ;                                                                                                                           /////// This has no effect here, it would continue anyway its search for the right index to splice. // MUST NOT use 'continue bouchechoice;' here.
                        } else {
                            alert(`Une erreur s'est produite dans le calcul de l'index du fruit √† supprimer. Retour au d√©but.`);
                            continue choiceLoop;
                        }
                    } 
                } else if (fruits.join(' * ').toLowerCase().includes( choice.toLowerCase() ) === false) {
                    alert('Je ne reconnais pas ce fruit. Veuillez r√©essayer.');
                    choice = 'retry';
                    continue choiceLoop;
                } else {
                    alert('Une erreur est survenue. Retour au d√©but.');
                }
            
            } else if (fruits.length !== 0 && infiniteChoice === 1) {                                                                                                                      
                confirmation = prompt(`Voulez-vous acheter un autre fruit ? ( [O]ui / [N]on )`) ;
                if (confirmation.toLowerCase() === 'oui' || confirmation.toLowerCase() === 'o' || confirmation.toLowerCase() ===  'yes' || confirmation.toLowerCase() === 'y') {
                    infiniteChoice = 0;
                    // alert("I am being an annoyance");        // FOR TEST PURPOSES
                    continue choiceLoop;
                } else if ( confirmation.toLowerCase() === 'non' || confirmation.toLowerCase() === 'n' ||confirmation.toLowerCase() === 'no') {
                    alert('Merci de votre achat. Passez une bonne journ√©e !');
                    end = true;
                } else {
                    for (confirmation, b=0 ; confirmation.toLowerCase() !== 'oui' || confirmation.toLowerCase() !== 'o' || confirmation.toLowerCase() !==  'yes' || confirmation.toLowerCase() !== 'y' || confirmation.toLowerCase() !== 'non' || confirmation.toLowerCase() !== 'n' || confirmation.toLowerCase() !== 'no'; b++ ) {
                        confirmation = prompt(`Je n'ai pas compris votre r√©ponse. Voulez-vous acheter un autre fruit ?  ( [O]ui / [N]on )`);
                        if (confirmation.toLowerCase() === 'oui' || confirmation.toLowerCase() === 'o' || confirmation.toLowerCase() ===  'yes' || confirmation.toLowerCase() === 'y') {
                            infiniteChoice = 0;
                            continue choiceLoop;
                        } else if ( confirmation.toLowerCase() === 'non' || confirmation.toLowerCase() === 'n' ||confirmation.toLowerCase() === 'no') {
                            alert('Merci de votre achat. Passez une bonne journ√©e !');
                            end = true;
                            break;
                        }
                    }
                }
        
            } else {
                alert('Une erreur est survenue. Veuillez rafra√Æchir la page.');
            }
            // alert('END FOR.'); // FOR TEST PURPOSES
        }
        // alert('END END'); // FOR TEST PURPOSES
        
    }
        </script>


<body>
    <p>CASINO</p>
    <div class="theButton">
        <button onclick="theGame()">Jouer</button>
    </div>
</body>
</html>